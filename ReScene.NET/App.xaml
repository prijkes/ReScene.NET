<Application x:Class="ReScene.NET.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:local="clr-namespace:ReScene.NET.Converters">

    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Resources/Tokens.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <!-- Override system selection colors for dark theme -->
            <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="#FF37373D" />
            <SolidColorBrush x:Key="{x:Static SystemColors.InactiveSelectionHighlightBrushKey}" Color="#FF37373D" />
            <SolidColorBrush x:Key="{x:Static SystemColors.HighlightTextBrushKey}" Color="#FFD4D4D4" />
            <SolidColorBrush x:Key="{x:Static SystemColors.InactiveSelectionHighlightTextBrushKey}" Color="#FFD4D4D4" />

            <!-- Converters -->
            <BooleanToVisibilityConverter x:Key="BoolToVisibility" />
            <local:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibility" />
            <local:IndexToVisibilityConverter x:Key="IndexToVisibility" />

            <!-- ══════════════════════════════════════════════════════════
                 Window
                 ══════════════════════════════════════════════════════════ -->

            <Style TargetType="Window">
                <Setter Property="Background" Value="{DynamicResource WindowBackground}" />
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                <Setter Property="FontFamily" Value="{DynamicResource UIFontFamily}" />
                <Setter Property="FontSize" Value="{DynamicResource FontSizeBody}" />
            </Style>

            <!-- ══════════════════════════════════════════════════════════
                 Button ControlTemplate
                 ══════════════════════════════════════════════════════════ -->

            <Style TargetType="Button">
                <Setter Property="Background" Value="{DynamicResource InputBackground}" />
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                <Setter Property="BorderBrush" Value="{DynamicResource BorderMedium}" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Padding" Value="8,4" />
                <Setter Property="SnapsToDevicePixels" Value="True" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="border"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="{DynamicResource MediumRadius}"
                                    Padding="{TemplateBinding Padding}"
                                    SnapsToDevicePixels="True">
                                <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                  VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                                  RecognizesAccessKey="True" />
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="#FF4E4E52" />
                                    <Setter TargetName="border" Property="BorderBrush" Value="#FF5A5A5A" />
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="#FF333333" />
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter Property="Foreground" Value="{DynamicResource ForegroundDisabled}" />
                                    <Setter TargetName="border" Property="BorderBrush" Value="{DynamicResource BorderSubtle}" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- Primary Button -->
            <Style x:Key="PrimaryButton" TargetType="Button">
                <Setter Property="Background" Value="{DynamicResource AccentPrimary}" />
                <Setter Property="Foreground" Value="White" />
                <Setter Property="BorderBrush" Value="{DynamicResource AccentPrimary}" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Padding" Value="8,4" />
                <Setter Property="SnapsToDevicePixels" Value="True" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="border"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="{DynamicResource MediumRadius}"
                                    Padding="{TemplateBinding Padding}"
                                    SnapsToDevicePixels="True">
                                <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                  VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                                  RecognizesAccessKey="True" />
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="{DynamicResource AccentHover}" />
                                    <Setter TargetName="border" Property="BorderBrush" Value="{DynamicResource AccentHover}" />
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="{DynamicResource AccentPressed}" />
                                    <Setter TargetName="border" Property="BorderBrush" Value="{DynamicResource AccentPressed}" />
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter Property="Foreground" Value="{DynamicResource ForegroundDisabled}" />
                                    <Setter TargetName="border" Property="Background" Value="{DynamicResource InputBackground}" />
                                    <Setter TargetName="border" Property="BorderBrush" Value="{DynamicResource BorderSubtle}" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- Cancel Button -->
            <Style x:Key="CancelButton" TargetType="Button">
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="Foreground" Value="{DynamicResource AccentError}" />
                <Setter Property="BorderBrush" Value="{DynamicResource AccentError}" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Padding" Value="8,4" />
                <Setter Property="SnapsToDevicePixels" Value="True" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="border"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="{DynamicResource MediumRadius}"
                                    Padding="{TemplateBinding Padding}"
                                    SnapsToDevicePixels="True">
                                <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                  VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                                  RecognizesAccessKey="True" />
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="#33F44747" />
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="#55F44747" />
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter Property="Foreground" Value="{DynamicResource ForegroundDisabled}" />
                                    <Setter TargetName="border" Property="BorderBrush" Value="{DynamicResource BorderSubtle}" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- Ghost Button -->
            <Style x:Key="GhostButton" TargetType="Button">
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                <Setter Property="BorderBrush" Value="{DynamicResource BorderMedium}" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Padding" Value="8,4" />
                <Setter Property="SnapsToDevicePixels" Value="True" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="border"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="{DynamicResource MediumRadius}"
                                    Padding="{TemplateBinding Padding}"
                                    SnapsToDevicePixels="True">
                                <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                  VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                                  RecognizesAccessKey="True" />
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="{DynamicResource HoverBackground}" />
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="#FF333333" />
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter Property="Foreground" Value="{DynamicResource ForegroundDisabled}" />
                                    <Setter TargetName="border" Property="BorderBrush" Value="{DynamicResource BorderSubtle}" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- ToolbarToggleButton: Ghost-style toggle for toolbar (e.g. Hex toggle) -->
            <Style x:Key="ToolbarToggleButton" TargetType="ToggleButton">
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                <Setter Property="BorderBrush" Value="{DynamicResource BorderMedium}" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Padding" Value="8,2" />
                <Setter Property="FontSize" Value="11" />
                <Setter Property="SnapsToDevicePixels" Value="True" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ToggleButton">
                            <Border x:Name="border"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="{DynamicResource MediumRadius}"
                                    Padding="{TemplateBinding Padding}"
                                    SnapsToDevicePixels="True">
                                <ContentPresenter HorizontalAlignment="Center"
                                                  VerticalAlignment="Center"
                                                  RecognizesAccessKey="True" />
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsChecked" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="{DynamicResource AccentPrimary}" />
                                    <Setter TargetName="border" Property="BorderBrush" Value="{DynamicResource AccentPrimary}" />
                                    <Setter Property="Foreground" Value="#FFFFFF" />
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="{DynamicResource HoverBackground}" />
                                </Trigger>
                                <MultiTrigger>
                                    <MultiTrigger.Conditions>
                                        <Condition Property="IsChecked" Value="True" />
                                        <Condition Property="IsMouseOver" Value="True" />
                                    </MultiTrigger.Conditions>
                                    <Setter TargetName="border" Property="Background" Value="{DynamicResource AccentHover}" />
                                    <Setter TargetName="border" Property="BorderBrush" Value="{DynamicResource AccentHover}" />
                                </MultiTrigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- ══════════════════════════════════════════════════════════
                 TextBox ControlTemplate
                 ══════════════════════════════════════════════════════════ -->

            <Style TargetType="TextBox">
                <Setter Property="Background" Value="{DynamicResource InputBackground}" />
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                <Setter Property="BorderBrush" Value="{DynamicResource BorderMedium}" />
                <Setter Property="BorderThickness" Value="1,1,1,2" />
                <Setter Property="CaretBrush" Value="{DynamicResource ForegroundPrimary}" />
                <Setter Property="SelectionBrush" Value="{DynamicResource AccentPrimary}" />
                <Setter Property="Padding" Value="4,3" />
                <Setter Property="SnapsToDevicePixels" Value="True" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="TextBox">
                            <Border x:Name="border"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="{DynamicResource SmallRadius}"
                                    SnapsToDevicePixels="True">
                                <ScrollViewer x:Name="PART_ContentHost"
                                              Margin="{TemplateBinding Padding}"
                                              Focusable="False"
                                              HorizontalScrollBarVisibility="Hidden"
                                              VerticalScrollBarVisibility="Hidden" />
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="border" Property="BorderBrush" Value="#FF5A5A5A" />
                                </Trigger>
                                <Trigger Property="IsKeyboardFocused" Value="True">
                                    <Setter TargetName="border" Property="BorderBrush" Value="{DynamicResource AccentPrimary}" />
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter Property="Foreground" Value="{DynamicResource ForegroundDisabled}" />
                                    <Setter TargetName="border" Property="Background" Value="{DynamicResource SurfaceBackground}" />
                                </Trigger>
                                <Trigger Property="IsReadOnly" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="{DynamicResource SurfaceBackground}" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- ══════════════════════════════════════════════════════════
                 TabControl + TabItem ControlTemplate
                 ══════════════════════════════════════════════════════════ -->

            <Style TargetType="TabControl">
                <Setter Property="Background" Value="{DynamicResource WindowBackground}" />
                <Setter Property="BorderBrush" Value="{DynamicResource BorderSubtle}" />
                <Setter Property="BorderThickness" Value="0" />
                <Setter Property="Padding" Value="0" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="TabControl">
                            <Grid KeyboardNavigation.TabNavigation="Local"
                                  SnapsToDevicePixels="True"
                                  ClipToBounds="True">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>
                                <!-- Tab strip background -->
                                <Border Grid.Row="0"
                                        Background="{DynamicResource SurfaceBackground}"
                                        BorderBrush="{DynamicResource BorderSeparator}"
                                        BorderThickness="0,0,0,1">
                                    <TabPanel IsItemsHost="True"
                                              Margin="0"
                                              KeyboardNavigation.TabIndex="1" />
                                </Border>
                                <!-- Content area -->
                                <Border Grid.Row="1"
                                        Background="{TemplateBinding Background}"
                                        BorderBrush="{TemplateBinding BorderBrush}"
                                        BorderThickness="{TemplateBinding BorderThickness}"
                                        KeyboardNavigation.TabNavigation="Local"
                                        KeyboardNavigation.DirectionalNavigation="Contained"
                                        KeyboardNavigation.TabIndex="2">
                                    <ContentPresenter x:Name="PART_SelectedContentHost"
                                                      ContentSource="SelectedContent"
                                                      Margin="{TemplateBinding Padding}"
                                                      SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                </Border>
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style TargetType="TabItem">
                <Setter Property="Foreground" Value="{DynamicResource ForegroundSecondary}" />
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="Padding" Value="12,6" />
                <Setter Property="MinHeight" Value="0" />
                <Setter Property="FontSize" Value="12" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="TabItem">
                            <Grid SnapsToDevicePixels="True">
                                <Border x:Name="tabBorder"
                                        Background="{TemplateBinding Background}"
                                        Padding="{TemplateBinding Padding}"
                                        BorderThickness="0,0,0,2"
                                        BorderBrush="Transparent">
                                    <ContentPresenter x:Name="contentPresenter"
                                                      ContentSource="Header"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Center"
                                                      RecognizesAccessKey="True" />
                                </Border>
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="tabBorder" Property="Background" Value="{DynamicResource HoverBackground}" />
                                </Trigger>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter TargetName="tabBorder" Property="Background" Value="{DynamicResource WindowBackground}" />
                                    <Setter TargetName="tabBorder" Property="BorderBrush" Value="{DynamicResource AccentPrimary}" />
                                    <Setter Property="Foreground" Value="{DynamicResource HeaderForeground}" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- ══════════════════════════════════════════════════════════
                 CheckBox ControlTemplate
                 ══════════════════════════════════════════════════════════ -->

            <Style TargetType="CheckBox">
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                <Setter Property="Background" Value="{DynamicResource InputBackground}" />
                <Setter Property="BorderBrush" Value="#FF6E6E6E" />
                <Setter Property="SnapsToDevicePixels" Value="True" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="CheckBox">
                            <BulletDecorator SnapsToDevicePixels="True"
                                             Background="Transparent">
                                <BulletDecorator.Bullet>
                                    <Border x:Name="checkBorder"
                                            Width="14" Height="14"
                                            Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="1"
                                            CornerRadius="{DynamicResource SmallRadius}">
                                        <Grid>
                                            <!-- Checkmark -->
                                            <Path x:Name="checkMark"
                                                  Data="M 1.5,4.5 L 5,8 L 10.5,1.5"
                                                  Stroke="White"
                                                  StrokeThickness="1.5"
                                                  Visibility="Collapsed"
                                                  Margin="1" />
                                            <!-- Indeterminate dash -->
                                            <Rectangle x:Name="indeterminateMark"
                                                       Width="8" Height="2"
                                                       Fill="White"
                                                       Visibility="Collapsed"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center" />
                                        </Grid>
                                    </Border>
                                </BulletDecorator.Bullet>
                                <ContentPresenter Margin="4,0,0,0"
                                                  VerticalAlignment="Center"
                                                  HorizontalAlignment="Left"
                                                  RecognizesAccessKey="True" />
                            </BulletDecorator>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsChecked" Value="True">
                                    <Setter TargetName="checkMark" Property="Visibility" Value="Visible" />
                                    <Setter TargetName="checkBorder" Property="Background" Value="{DynamicResource AccentPrimary}" />
                                    <Setter TargetName="checkBorder" Property="BorderBrush" Value="{DynamicResource AccentPrimary}" />
                                </Trigger>
                                <Trigger Property="IsChecked" Value="{x:Null}">
                                    <Setter TargetName="indeterminateMark" Property="Visibility" Value="Visible" />
                                    <Setter TargetName="checkBorder" Property="Background" Value="{DynamicResource AccentPrimary}" />
                                    <Setter TargetName="checkBorder" Property="BorderBrush" Value="{DynamicResource AccentPrimary}" />
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="checkBorder" Property="BorderBrush" Value="{DynamicResource AccentHover}" />
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter Property="Foreground" Value="{DynamicResource ForegroundDisabled}" />
                                    <Setter TargetName="checkBorder" Property="BorderBrush" Value="{DynamicResource ForegroundDisabled}" />
                                    <Setter TargetName="checkBorder" Property="Background" Value="{DynamicResource SurfaceBackground}" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- ══════════════════════════════════════════════════════════
                 RadioButton
                 ══════════════════════════════════════════════════════════ -->

            <Style TargetType="RadioButton">
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                <Setter Property="Background" Value="{DynamicResource InputBackground}" />
                <Setter Property="BorderBrush" Value="#FF6E6E6E" />
                <Setter Property="SnapsToDevicePixels" Value="True" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="RadioButton">
                            <BulletDecorator SnapsToDevicePixels="True"
                                             Background="Transparent">
                                <BulletDecorator.Bullet>
                                    <Grid>
                                        <Ellipse x:Name="radioBorder"
                                                 Width="14" Height="14"
                                                 Fill="{TemplateBinding Background}"
                                                 Stroke="{TemplateBinding BorderBrush}"
                                                 StrokeThickness="1" />
                                        <Ellipse x:Name="radioDot"
                                                 Width="6" Height="6"
                                                 Fill="White"
                                                 Visibility="Collapsed"
                                                 HorizontalAlignment="Center"
                                                 VerticalAlignment="Center" />
                                    </Grid>
                                </BulletDecorator.Bullet>
                                <ContentPresenter Margin="4,0,0,0"
                                                  VerticalAlignment="Center"
                                                  HorizontalAlignment="Left"
                                                  RecognizesAccessKey="True" />
                            </BulletDecorator>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsChecked" Value="True">
                                    <Setter TargetName="radioDot" Property="Visibility" Value="Visible" />
                                    <Setter TargetName="radioBorder" Property="Fill" Value="{DynamicResource AccentPrimary}" />
                                    <Setter TargetName="radioBorder" Property="Stroke" Value="{DynamicResource AccentPrimary}" />
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="radioBorder" Property="Stroke" Value="{DynamicResource AccentHover}" />
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter Property="Foreground" Value="{DynamicResource ForegroundDisabled}" />
                                    <Setter TargetName="radioBorder" Property="Stroke" Value="{DynamicResource ForegroundDisabled}" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- ══════════════════════════════════════════════════════════
                 Expander ControlTemplate
                 ══════════════════════════════════════════════════════════ -->

            <Style TargetType="Expander">
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                <Setter Property="Background" Value="{DynamicResource PanelBackground}" />
                <Setter Property="BorderBrush" Value="{DynamicResource BorderSubtle}" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Expander">
                            <Border BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="{DynamicResource MediumRadius}"
                                    SnapsToDevicePixels="True">
                                <DockPanel>
                                    <!-- Header -->
                                    <ToggleButton x:Name="HeaderSite"
                                                  DockPanel.Dock="Top"
                                                  IsChecked="{Binding IsExpanded, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                                  OverridesDefaultStyle="True"
                                                  Cursor="Hand"
                                                  Focusable="False">
                                        <ToggleButton.Template>
                                            <ControlTemplate TargetType="ToggleButton">
                                                <Border x:Name="headerBorder"
                                                        Background="{DynamicResource SurfaceBackground}"
                                                        Padding="8,6"
                                                        CornerRadius="3,3,0,0">
                                                    <DockPanel>
                                                        <TextBlock x:Name="chevron"
                                                                   DockPanel.Dock="Left"
                                                                   Text="&#xE76C;"
                                                                   FontFamily="{DynamicResource SymbolThemeFontFamily}"
                                                                   FontSize="10"
                                                                   VerticalAlignment="Center"
                                                                   Foreground="{DynamicResource ForegroundSecondary}"
                                                                   Margin="0,0,6,0" />
                                                        <ContentPresenter ContentSource="Content"
                                                                          VerticalAlignment="Center" />
                                                    </DockPanel>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsChecked" Value="True">
                                                        <Setter TargetName="chevron" Property="Text" Value="&#xE70D;" />
                                                    </Trigger>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="headerBorder" Property="Background" Value="{DynamicResource HoverBackground}" />
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </ToggleButton.Template>
                                        <ContentPresenter ContentSource="Header"
                                                          RecognizesAccessKey="True" />
                                    </ToggleButton>
                                    <!-- Content -->
                                    <Border x:Name="contentBorder"
                                            Background="{TemplateBinding Background}"
                                            Visibility="Collapsed">
                                        <ContentPresenter Margin="{TemplateBinding Padding}" />
                                    </Border>
                                </DockPanel>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsExpanded" Value="True">
                                    <Setter TargetName="contentBorder" Property="Visibility" Value="Visible" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- ══════════════════════════════════════════════════════════
                 ComboBox ControlTemplate
                 ══════════════════════════════════════════════════════════ -->

            <ControlTemplate x:Key="ComboBoxToggleButton" TargetType="ToggleButton">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition />
                        <ColumnDefinition Width="20" />
                    </Grid.ColumnDefinitions>
                    <Border x:Name="templateRoot"
                            Grid.ColumnSpan="2"
                            Background="{DynamicResource InputBackground}"
                            BorderBrush="{DynamicResource BorderMedium}"
                            BorderThickness="1"
                            CornerRadius="{DynamicResource SmallRadius}"
                            SnapsToDevicePixels="True" />
                    <Border Grid.Column="0"
                            Margin="1" Background="Transparent" />
                    <Path x:Name="arrow"
                          Grid.Column="1"
                          Data="M 0,0 L 4,4 L 8,0"
                          Fill="{DynamicResource ForegroundSecondary}"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center" />
                </Grid>
                <ControlTemplate.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter TargetName="templateRoot" Property="BorderBrush" Value="#FF5A5A5A" />
                    </Trigger>
                    <Trigger Property="IsChecked" Value="True">
                        <Setter TargetName="templateRoot" Property="BorderBrush" Value="{DynamicResource AccentPrimary}" />
                    </Trigger>
                    <Trigger Property="IsEnabled" Value="False">
                        <Setter TargetName="templateRoot" Property="Background" Value="{DynamicResource SurfaceBackground}" />
                        <Setter TargetName="templateRoot" Property="BorderBrush" Value="{DynamicResource BorderSubtle}" />
                        <Setter TargetName="arrow" Property="Fill" Value="{DynamicResource ForegroundDisabled}" />
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>

            <Style TargetType="ComboBox">
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                <Setter Property="Background" Value="{DynamicResource InputBackground}" />
                <Setter Property="BorderBrush" Value="{DynamicResource BorderMedium}" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Padding" Value="4,3" />
                <Setter Property="SnapsToDevicePixels" Value="True" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ComboBox">
                            <Grid SnapsToDevicePixels="True">
                                <ToggleButton x:Name="toggleButton"
                                              Template="{StaticResource ComboBoxToggleButton}"
                                              IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                              Focusable="False"
                                              ClickMode="Press" />
                                <ContentPresenter x:Name="contentPresenter"
                                                  IsHitTestVisible="False"
                                                  Content="{TemplateBinding SelectionBoxItem}"
                                                  ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                                  ContentStringFormat="{TemplateBinding SelectionBoxItemStringFormat}"
                                                  Margin="6,3,24,3"
                                                  VerticalAlignment="Center"
                                                  HorizontalAlignment="Left"
                                                  TextElement.Foreground="{TemplateBinding Foreground}" />
                                <Popup x:Name="PART_Popup"
                                       IsOpen="{TemplateBinding IsDropDownOpen}"
                                       Placement="Bottom"
                                       AllowsTransparency="True"
                                       Focusable="False"
                                       PopupAnimation="Slide">
                                    <Border x:Name="dropDownBorder"
                                            MinWidth="{TemplateBinding ActualWidth}"
                                            MaxHeight="{TemplateBinding MaxDropDownHeight}"
                                            Background="{DynamicResource SurfaceBackground}"
                                            BorderBrush="{DynamicResource BorderMedium}"
                                            BorderThickness="1"
                                            CornerRadius="{DynamicResource SmallRadius}"
                                            Margin="0,1,0,0">
                                        <ScrollViewer SnapsToDevicePixels="True">
                                            <StackPanel IsItemsHost="True"
                                                        KeyboardNavigation.DirectionalNavigation="Contained" />
                                        </ScrollViewer>
                                    </Border>
                                </Popup>
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter TargetName="contentPresenter" Property="Opacity" Value="0.35" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
                <Style.Triggers>
                    <Trigger Property="IsEnabled" Value="False">
                        <Setter Property="Foreground" Value="{DynamicResource ForegroundDisabled}" />
                    </Trigger>
                </Style.Triggers>
            </Style>

            <Style TargetType="ComboBoxItem">
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="Padding" Value="6,4" />
                <Setter Property="SnapsToDevicePixels" Value="True" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ComboBoxItem">
                            <Border x:Name="itemBorder"
                                    Background="{TemplateBinding Background}"
                                    Padding="{TemplateBinding Padding}"
                                    SnapsToDevicePixels="True">
                                <ContentPresenter />
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsHighlighted" Value="True">
                                    <Setter TargetName="itemBorder" Property="Background" Value="{DynamicResource ActiveBackground}" />
                                    <Setter Property="Foreground" Value="White" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- ══════════════════════════════════════════════════════════
                 ProgressBar ControlTemplate
                 ══════════════════════════════════════════════════════════ -->

            <Style TargetType="ProgressBar">
                <Setter Property="Background" Value="{DynamicResource InputBackground}" />
                <Setter Property="Foreground" Value="{DynamicResource AccentPrimary}" />
                <Setter Property="BorderThickness" Value="0" />
                <Setter Property="Height" Value="4" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ProgressBar">
                            <Grid SnapsToDevicePixels="True">
                                <!-- Track -->
                                <Border x:Name="PART_Track"
                                        Background="{TemplateBinding Background}"
                                        CornerRadius="{DynamicResource SmallRadius}" />
                                <!-- Indicator -->
                                <Border x:Name="PART_Indicator"
                                        HorizontalAlignment="Left"
                                        Background="{TemplateBinding Foreground}"
                                        CornerRadius="{DynamicResource SmallRadius}" />
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- ══════════════════════════════════════════════════════════
                 ScrollBar ControlTemplate
                 ══════════════════════════════════════════════════════════ -->

            <!-- Transparent RepeatButton for scroll page areas -->
            <Style x:Key="ScrollBarPageButton" TargetType="RepeatButton">
                <Setter Property="OverridesDefaultStyle" Value="True" />
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="Focusable" Value="False" />
                <Setter Property="IsTabStop" Value="False" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="RepeatButton">
                            <Border Background="Transparent" />
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- Thumb style -->
            <Style x:Key="ScrollBarThumb" TargetType="Thumb">
                <Setter Property="OverridesDefaultStyle" Value="True" />
                <Setter Property="IsTabStop" Value="False" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Thumb">
                            <Border x:Name="thumbBorder"
                                    Background="#FF4D4D4D"
                                    CornerRadius="4" />
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="thumbBorder" Property="Background" Value="#FF6E6E6E" />
                                </Trigger>
                                <Trigger Property="IsDragging" Value="True">
                                    <Setter TargetName="thumbBorder" Property="Background" Value="#FF8E8E8E" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- Vertical ScrollBar -->
            <ControlTemplate x:Key="VerticalScrollBar" TargetType="ScrollBar">
                <Grid Width="8">
                    <Border Background="Transparent" />
                    <Track x:Name="PART_Track" IsDirectionReversed="True">
                        <Track.DecreaseRepeatButton>
                            <RepeatButton Style="{StaticResource ScrollBarPageButton}"
                                          Command="ScrollBar.PageUpCommand" />
                        </Track.DecreaseRepeatButton>
                        <Track.Thumb>
                            <Thumb Style="{StaticResource ScrollBarThumb}"
                                   MinHeight="20" />
                        </Track.Thumb>
                        <Track.IncreaseRepeatButton>
                            <RepeatButton Style="{StaticResource ScrollBarPageButton}"
                                          Command="ScrollBar.PageDownCommand" />
                        </Track.IncreaseRepeatButton>
                    </Track>
                </Grid>
            </ControlTemplate>

            <!-- Horizontal ScrollBar -->
            <ControlTemplate x:Key="HorizontalScrollBar" TargetType="ScrollBar">
                <Grid Height="8">
                    <Border Background="Transparent" />
                    <Track x:Name="PART_Track" IsDirectionReversed="False">
                        <Track.DecreaseRepeatButton>
                            <RepeatButton Style="{StaticResource ScrollBarPageButton}"
                                          Command="ScrollBar.PageLeftCommand" />
                        </Track.DecreaseRepeatButton>
                        <Track.Thumb>
                            <Thumb Style="{StaticResource ScrollBarThumb}"
                                   MinWidth="20" />
                        </Track.Thumb>
                        <Track.IncreaseRepeatButton>
                            <RepeatButton Style="{StaticResource ScrollBarPageButton}"
                                          Command="ScrollBar.PageRightCommand" />
                        </Track.IncreaseRepeatButton>
                    </Track>
                </Grid>
            </ControlTemplate>

            <Style TargetType="ScrollBar">
                <Setter Property="SnapsToDevicePixels" Value="True" />
                <Setter Property="OverridesDefaultStyle" Value="True" />
                <Style.Triggers>
                    <Trigger Property="Orientation" Value="Vertical">
                        <Setter Property="Width" Value="8" />
                        <Setter Property="Height" Value="Auto" />
                        <Setter Property="Template" Value="{StaticResource VerticalScrollBar}" />
                    </Trigger>
                    <Trigger Property="Orientation" Value="Horizontal">
                        <Setter Property="Width" Value="Auto" />
                        <Setter Property="Height" Value="8" />
                        <Setter Property="Template" Value="{StaticResource HorizontalScrollBar}" />
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!-- ══════════════════════════════════════════════════════════
                 ScrollViewer
                 ══════════════════════════════════════════════════════════ -->

            <Style TargetType="ScrollViewer">
                <Setter Property="Background" Value="Transparent" />
            </Style>

            <!-- ══════════════════════════════════════════════════════════
                 Menu / MenuItem ControlTemplate
                 ══════════════════════════════════════════════════════════ -->

            <Style TargetType="Menu">
                <Setter Property="Background" Value="{DynamicResource SurfaceBackground}" />
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                <Setter Property="BorderThickness" Value="0" />
            </Style>

            <!-- MenuItem: TopLevelHeader (e.g. "File", "View", "Help") -->
            <ControlTemplate x:Key="MenuItemTopLevelHeaderTemplate" TargetType="MenuItem">
                <Border x:Name="border"
                        Background="Transparent"
                        BorderThickness="0"
                        Padding="6,4">
                    <Grid>
                        <ContentPresenter ContentSource="Header"
                                          RecognizesAccessKey="True" />
                        <Popup IsOpen="{Binding IsSubmenuOpen, RelativeSource={RelativeSource TemplatedParent}}"
                               Placement="Bottom"
                               AllowsTransparency="True"
                               Focusable="False"
                               PopupAnimation="Fade">
                            <Border Background="{DynamicResource SurfaceBackground}"
                                    BorderBrush="{DynamicResource BorderMedium}"
                                    BorderThickness="1"
                                    Padding="0,2">
                                <StackPanel IsItemsHost="True"
                                            Grid.IsSharedSizeScope="True"
                                            KeyboardNavigation.DirectionalNavigation="Cycle" />
                            </Border>
                        </Popup>
                    </Grid>
                </Border>
                <ControlTemplate.Triggers>
                    <Trigger Property="IsHighlighted" Value="True">
                        <Setter TargetName="border" Property="Background" Value="{DynamicResource HoverBackground}" />
                    </Trigger>
                    <Trigger Property="IsSubmenuOpen" Value="True">
                        <Setter TargetName="border" Property="Background" Value="{DynamicResource ActiveBackground}" />
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>

            <!-- MenuItem: TopLevelItem (top-level without submenu) -->
            <ControlTemplate x:Key="MenuItemTopLevelItemTemplate" TargetType="MenuItem">
                <Border x:Name="border"
                        Background="Transparent"
                        BorderThickness="0"
                        Padding="6,4">
                    <ContentPresenter ContentSource="Header"
                                      RecognizesAccessKey="True" />
                </Border>
                <ControlTemplate.Triggers>
                    <Trigger Property="IsHighlighted" Value="True">
                        <Setter TargetName="border" Property="Background" Value="{DynamicResource HoverBackground}" />
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>

            <!-- MenuItem: SubmenuItem (dropdown item like "Open...", "Exit") -->
            <ControlTemplate x:Key="MenuItemSubmenuItemTemplate" TargetType="MenuItem">
                <Border x:Name="border"
                        Background="Transparent"
                        BorderThickness="0"
                        Padding="4,4,8,4">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" SharedSizeGroup="MenuItemIconColumnGroup" MinWidth="24" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" SharedSizeGroup="MenuItemShortcutColumnGroup" />
                        </Grid.ColumnDefinitions>
                        <ContentPresenter x:Name="Icon"
                                          ContentSource="Icon"
                                          Width="16" Height="16"
                                          Margin="0,0,6,0"
                                          VerticalAlignment="Center"
                                          SnapsToDevicePixels="True" />
                        <ContentPresenter Grid.Column="1"
                                          ContentSource="Header"
                                          RecognizesAccessKey="True"
                                          VerticalAlignment="Center" />
                        <TextBlock Grid.Column="2"
                                   Text="{TemplateBinding InputGestureText}"
                                   Foreground="{DynamicResource ForegroundSecondary}"
                                   Margin="24,0,0,0"
                                   VerticalAlignment="Center" />
                    </Grid>
                </Border>
                <ControlTemplate.Triggers>
                    <Trigger Property="Icon" Value="{x:Null}">
                        <Setter TargetName="Icon" Property="Visibility" Value="Collapsed" />
                    </Trigger>
                    <Trigger Property="IsHighlighted" Value="True">
                        <Setter TargetName="border" Property="Background" Value="{DynamicResource ActiveBackground}" />
                    </Trigger>
                    <Trigger Property="IsEnabled" Value="False">
                        <Setter Property="Foreground" Value="{DynamicResource ForegroundDisabled}" />
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>

            <!-- MenuItem: SubmenuHeader (submenu item that opens a sub-submenu) -->
            <ControlTemplate x:Key="MenuItemSubmenuHeaderTemplate" TargetType="MenuItem">
                <Border x:Name="border"
                        Background="Transparent"
                        BorderThickness="0"
                        Padding="4,4,8,4">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" SharedSizeGroup="MenuItemIconColumnGroup" MinWidth="24" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <ContentPresenter x:Name="Icon"
                                          ContentSource="Icon"
                                          Width="16" Height="16"
                                          Margin="0,0,6,0"
                                          VerticalAlignment="Center"
                                          SnapsToDevicePixels="True" />
                        <ContentPresenter Grid.Column="1"
                                          ContentSource="Header"
                                          RecognizesAccessKey="True"
                                          VerticalAlignment="Center" />
                        <Path Grid.Column="2"
                              Data="M0,0 L4,3.5 L0,7 Z"
                              Fill="{DynamicResource ForegroundSecondary}"
                              VerticalAlignment="Center"
                              Margin="8,0,0,0" />
                        <Popup IsOpen="{Binding IsSubmenuOpen, RelativeSource={RelativeSource TemplatedParent}}"
                               Placement="Right"
                               AllowsTransparency="True"
                               Focusable="False"
                               PopupAnimation="Fade">
                            <Border Background="{DynamicResource SurfaceBackground}"
                                    BorderBrush="{DynamicResource BorderMedium}"
                                    BorderThickness="1"
                                    Padding="0,2">
                                <StackPanel IsItemsHost="True"
                                            Grid.IsSharedSizeScope="True"
                                            KeyboardNavigation.DirectionalNavigation="Cycle" />
                            </Border>
                        </Popup>
                    </Grid>
                </Border>
                <ControlTemplate.Triggers>
                    <Trigger Property="Icon" Value="{x:Null}">
                        <Setter TargetName="Icon" Property="Visibility" Value="Collapsed" />
                    </Trigger>
                    <Trigger Property="IsHighlighted" Value="True">
                        <Setter TargetName="border" Property="Background" Value="{DynamicResource ActiveBackground}" />
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>

            <Style TargetType="MenuItem">
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                <Setter Property="Background" Value="Transparent" />
                <Style.Triggers>
                    <Trigger Property="Role" Value="TopLevelHeader">
                        <Setter Property="Template" Value="{StaticResource MenuItemTopLevelHeaderTemplate}" />
                    </Trigger>
                    <Trigger Property="Role" Value="TopLevelItem">
                        <Setter Property="Template" Value="{StaticResource MenuItemTopLevelItemTemplate}" />
                    </Trigger>
                    <Trigger Property="Role" Value="SubmenuItem">
                        <Setter Property="Template" Value="{StaticResource MenuItemSubmenuItemTemplate}" />
                    </Trigger>
                    <Trigger Property="Role" Value="SubmenuHeader">
                        <Setter Property="Template" Value="{StaticResource MenuItemSubmenuHeaderTemplate}" />
                    </Trigger>
                </Style.Triggers>
            </Style>

            <Style TargetType="ContextMenu">
                <Setter Property="Background" Value="{DynamicResource SurfaceBackground}" />
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                <Setter Property="BorderBrush" Value="{DynamicResource BorderMedium}" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="SnapsToDevicePixels" Value="True" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ContextMenu">
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="{DynamicResource SmallRadius}"
                                    Padding="0,2"
                                    SnapsToDevicePixels="True">
                                <StackPanel IsItemsHost="True"
                                            Grid.IsSharedSizeScope="True"
                                            KeyboardNavigation.DirectionalNavigation="Cycle" />
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- ToolBar / ToolBarTray dark theme -->
            <Style TargetType="ToolBarTray">
                <Setter Property="Background" Value="{DynamicResource SurfaceBackground}" />
            </Style>

            <Style TargetType="ToolBar">
                <Setter Property="Background" Value="{DynamicResource SurfaceBackground}" />
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                <Setter Property="BorderThickness" Value="0" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ToolBar">
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{DynamicResource BorderSeparator}"
                                    BorderThickness="0,0,0,1"
                                    Padding="2,1">
                                <DockPanel>
                                    <!-- Hide the overflow toggle grip -->
                                    <ToggleButton DockPanel.Dock="Right"
                                                  IsEnabled="{TemplateBinding HasOverflowItems}"
                                                  Visibility="Collapsed" />
                                    <ToolBarPanel x:Name="PART_ToolBarPanel"
                                                  IsItemsHost="True"
                                                  Margin="0" />
                                </DockPanel>
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- ══════════════════════════════════════════════════════════
                 Separator (in menus)
                 ══════════════════════════════════════════════════════════ -->

            <Style TargetType="Separator">
                <Setter Property="Background" Value="{DynamicResource BorderSeparator}" />
                <Setter Property="Height" Value="1" />
                <Setter Property="Margin" Value="4,2" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Separator">
                            <Border Background="{TemplateBinding Background}"
                                    Height="{TemplateBinding Height}"
                                    Margin="{TemplateBinding Margin}" />
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- ══════════════════════════════════════════════════════════
                 DataGrid
                 ══════════════════════════════════════════════════════════ -->

            <Style TargetType="DataGrid">
                <Setter Property="Background" Value="{DynamicResource PanelBackground}" />
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                <Setter Property="BorderBrush" Value="{DynamicResource BorderSubtle}" />
                <Setter Property="RowBackground" Value="Transparent" />
                <Setter Property="AlternatingRowBackground" Value="Transparent" />
                <Setter Property="HorizontalGridLinesBrush" Value="{DynamicResource BorderSeparator}" />
                <Setter Property="VerticalGridLinesBrush" Value="{DynamicResource BorderSeparator}" />
            </Style>

            <Style TargetType="DataGridColumnHeader">
                <Setter Property="Background" Value="{DynamicResource SurfaceBackground}" />
                <Setter Property="Foreground" Value="{DynamicResource ForegroundSecondary}" />
                <Setter Property="FontSize" Value="11" />
                <Setter Property="FontWeight" Value="SemiBold" />
                <Setter Property="Padding" Value="6,4" />
                <Setter Property="BorderBrush" Value="{DynamicResource BorderSeparator}" />
                <Setter Property="BorderThickness" Value="0,0,1,1" />
            </Style>

            <Style TargetType="DataGridRow">
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                <Style.Triggers>
                    <Trigger Property="IsSelected" Value="True">
                        <Setter Property="Background" Value="{DynamicResource SelectedItemBackground}" />
                    </Trigger>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="{DynamicResource HoverBackground}" />
                    </Trigger>
                </Style.Triggers>
            </Style>

            <Style TargetType="DataGridCell">
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                <Setter Property="BorderThickness" Value="0" />
                <Setter Property="Padding" Value="6,3" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="DataGridCell">
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    Padding="{TemplateBinding Padding}"
                                    SnapsToDevicePixels="True">
                                <ContentPresenter SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
                <Style.Triggers>
                    <Trigger Property="IsSelected" Value="True">
                        <Setter Property="Background" Value="{DynamicResource SelectedItemBackground}" />
                        <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!-- ══════════════════════════════════════════════════════════
                 TreeView / TreeViewItem
                 ══════════════════════════════════════════════════════════ -->

            <Style TargetType="TreeView">
                <Setter Property="Background" Value="{DynamicResource PanelBackground}" />
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                <Setter Property="BorderThickness" Value="0" />
            </Style>

            <Style TargetType="TreeViewItem">
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                <Setter Property="Background" Value="Transparent" />
                <Style.Triggers>
                    <Trigger Property="IsSelected" Value="True">
                        <Setter Property="Background" Value="{DynamicResource SelectedItemBackground}" />
                    </Trigger>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="{DynamicResource HoverBackground}" />
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!-- ══════════════════════════════════════════════════════════
                 ListBox / ListBoxItem
                 ══════════════════════════════════════════════════════════ -->

            <Style TargetType="ListBox">
                <Setter Property="Background" Value="{DynamicResource PanelBackground}" />
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                <Setter Property="BorderBrush" Value="{DynamicResource BorderSubtle}" />
                <Setter Property="BorderThickness" Value="1" />
            </Style>

            <Style TargetType="ListBoxItem">
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="Padding" Value="4,2" />
                <Style.Triggers>
                    <Trigger Property="IsSelected" Value="True">
                        <Setter Property="Background" Value="{DynamicResource SelectedItemBackground}" />
                    </Trigger>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="{DynamicResource HoverBackground}" />
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!-- ══════════════════════════════════════════════════════════
                 GridSplitter
                 ══════════════════════════════════════════════════════════ -->

            <Style TargetType="GridSplitter">
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="GridSplitter">
                            <Grid Background="Transparent">
                                <!-- Grip pill (shown on hover) -->
                                <Border x:Name="gripPill"
                                        Width="24" Height="3"
                                        Background="{DynamicResource BorderMedium}"
                                        CornerRadius="2"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Opacity="0" />
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="gripPill" Property="Opacity" Value="1" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- ══════════════════════════════════════════════════════════
                 ToolTip
                 ══════════════════════════════════════════════════════════ -->

            <Style TargetType="ToolTip">
                <Setter Property="Background" Value="#FF383838" />
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                <Setter Property="BorderBrush" Value="{DynamicResource BorderMedium}" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Padding" Value="8,4" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ToolTip">
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="{DynamicResource MediumRadius}"
                                    Padding="{TemplateBinding Padding}">
                                <ContentPresenter />
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- ══════════════════════════════════════════════════════════
                 TextBlock (global default)
                 ══════════════════════════════════════════════════════════ -->

            <Style TargetType="TextBlock">
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
            </Style>

            <!-- ══════════════════════════════════════════════════════════
                 Label
                 ══════════════════════════════════════════════════════════ -->

            <Style TargetType="Label">
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
            </Style>

            <!-- ══════════════════════════════════════════════════════════
                 Keyed styles (application-specific)
                 ══════════════════════════════════════════════════════════ -->

            <!-- Monospaced text -->
            <Style x:Key="MonoText" TargetType="TextBlock">
                <Setter Property="FontFamily" Value="{DynamicResource MonoFontFamily}" />
                <Setter Property="FontSize" Value="{DynamicResource MonoFontSize}" />
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
            </Style>

            <!-- ── Inspector panel styles ────────────────────────── -->

            <Style x:Key="PanelHeaderText" TargetType="TextBlock">
                <Setter Property="FontSize" Value="{DynamicResource SectionHeaderFontSize}" />
                <Setter Property="FontWeight" Value="SemiBold" />
                <Setter Property="Foreground" Value="{DynamicResource HeaderForeground}" />
            </Style>

            <Style x:Key="PanelHeaderBar" TargetType="Border">
                <Setter Property="Padding" Value="{DynamicResource PanelHeaderPadding}" />
                <Setter Property="Background" Value="{DynamicResource SurfaceBackground}" />
                <Setter Property="BorderBrush" Value="{DynamicResource BorderSeparator}" />
                <Setter Property="BorderThickness" Value="0,0,0,1" />
            </Style>

            <Style x:Key="PanelSection" TargetType="Border">
                <Setter Property="Background" Value="{DynamicResource PanelBackground}" />
                <Setter Property="BorderBrush" Value="{DynamicResource BorderSubtle}" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="CornerRadius" Value="{DynamicResource SmallRadius}" />
            </Style>

            <!-- Compact log ListBox -->
            <Style x:Key="CompactLogListBox" TargetType="ListBox" BasedOn="{StaticResource {x:Type ListBox}}">
                <Setter Property="Background" Value="{DynamicResource PanelBackground}" />
                <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                <Setter Property="ItemContainerStyle">
                    <Setter.Value>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="MinHeight" Value="18" />
                            <Setter Property="Padding" Value="4,1" />
                            <Setter Property="Foreground" Value="{DynamicResource ForegroundPrimary}" />
                            <Setter Property="Background" Value="Transparent" />
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource SelectedItemBackground}" />
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource HoverBackground}" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- Recent file item button -->
            <Style x:Key="RecentFileItemButton" TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="BorderThickness" Value="0" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="border"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    Padding="{TemplateBinding Padding}"
                                    SnapsToDevicePixels="True">
                                <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                  VerticalAlignment="{TemplateBinding VerticalContentAlignment}" />
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="{DynamicResource HoverBackground}" />
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="{DynamicResource ActiveBackground}" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

        </ResourceDictionary>
    </Application.Resources>

</Application>
